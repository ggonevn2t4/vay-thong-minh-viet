import { LoanProductType, CustomQuestionForm } from '@/types/loan-application-flow';

// Optimized questionnaire structure with conditional logic and smart categorization
export interface OptimizedQuestion {
  id: string;
  type: 'text' | 'number' | 'select' | 'textarea' | 'checkbox' | 'radio' | 'date';
  label: string;
  placeholder?: string;
  required: boolean;
  validation?: {
    min?: number;
    max?: number;
    pattern?: string;
    message?: string;
  };
  options?: string[];
  category: 'basic' | 'financial' | 'employment' | 'credit' | 'product_specific' | 'additional';
  priority: 'high' | 'medium' | 'low'; // For progressive disclosure
  dependsOn?: string; // Field ID that this question depends on
  showWhen?: (value: any) => boolean; // Conditional logic
  helpText?: string; // Additional guidance for users
  icon?: string; // Icon for visual enhancement
}

export interface OptimizedQuestionForm {
  productType: LoanProductType;
  title: string;
  description: string;
  estimatedTime: string; // "5-7 ph√∫t"
  categories: {
    id: string;
    name: string;
    description: string;
    icon: string;
    questions: OptimizedQuestion[];
  }[];
  smartValidation: {
    creditScoreEstimation: boolean;
    incomeVerification: boolean;
    riskAssessment: boolean;
  };
}

// Credit Card Questionnaire (Optimized)
const creditCardQuestionnaire: OptimizedQuestionForm = {
  productType: 'credit_loan',
  title: 'ƒêƒÉng k√Ω Th·∫ª T√≠n D·ª•ng',
  description: 'Ho√†n th√†nh th√¥ng tin ƒë·ªÉ nh·∫≠n ƒë·ªÅ xu·∫•t th·∫ª t√≠n d·ª•ng ph√π h·ª£p nh·∫•t',
  estimatedTime: '5-7 ph√∫t',
  categories: [
    {
      id: 'product_specific',
      name: 'Th√¥ng tin th·∫ª mong mu·ªën',
      description: 'Cho ch√∫ng t√¥i bi·∫øt lo·∫°i th·∫ª b·∫°n quan t√¢m',
      icon: 'üí≥',
      questions: [
        {
          id: 'desired_credit_limit',
          type: 'select',
          label: 'H·∫°n m·ª©c th·∫ª mong mu·ªën',
          required: true,
          options: [
            '5-10 tri·ªáu VNƒê',
            '10-20 tri·ªáu VNƒê', 
            '20-50 tri·ªáu VNƒê',
            '50-100 tri·ªáu VNƒê',
            'Tr√™n 100 tri·ªáu VNƒê'
          ],
          category: 'product_specific',
          priority: 'high',
          helpText: 'Ch·ªçn m·ª©c h·∫°n m·ª©c ph√π h·ª£p v·ªõi kh·∫£ nƒÉng t√†i ch√≠nh c·ªßa b·∫°n',
          icon: 'üí∞'
        },
        {
          id: 'card_usage_purpose',
          type: 'checkbox',
          label: 'M·ª•c ƒë√≠ch s·ª≠ d·ª•ng th·∫ª ch√≠nh',
          required: true,
          options: [
            'Mua s·∫Øm h√†ng ng√†y',
            'Du l·ªãch trong n∆∞·ªõc',
            'Du l·ªãch qu·ªëc t·∫ø',
            'Thanh to√°n online',
            'R√∫t ti·ªÅn m·∫∑t',
            'T√≠ch ƒëi·ªÉm ƒë·ªïi qu√†'
          ],
          category: 'product_specific',
          priority: 'high',
          helpText: 'Ch·ªçn t·ªëi ƒëa 3 m·ª•c ƒë√≠ch ch√≠nh ƒë·ªÉ nh·∫≠n ƒë·ªÅ xu·∫•t ph√π h·ª£p',
          icon: 'üõçÔ∏è'
        },
        {
          id: 'preferred_card_brand',
          type: 'select',
          label: 'Th∆∞∆°ng hi·ªáu th·∫ª ∆∞u ti√™n',
          required: false,
          options: ['Visa', 'Mastercard', 'JCB', 'Kh√¥ng c√≥ ∆∞u ti√™n ƒë·∫∑c bi·ªát'],
          category: 'product_specific',
          priority: 'medium',
          icon: 'üè∑Ô∏è'
        }
      ]
    },
    {
      id: 'basic',
      name: 'Th√¥ng tin c√° nh√¢n',
      description: 'Th√¥ng tin c∆° b·∫£n ƒë·ªÉ x√°c minh danh t√≠nh',
      icon: 'üë§',
      questions: [
        {
          id: 'full_name',
          type: 'text',
          label: 'H·ªç v√† t√™n',
          placeholder: 'Nguy·ªÖn VƒÉn A',
          required: true,
          category: 'basic',
          priority: 'high',
          validation: {
            pattern: '^[a-zA-Z√Ä-·ªπ\\s]{2,50}$',
            message: 'H·ªç t√™n ph·∫£i t·ª´ 2-50 k√Ω t·ª±, ch·ªâ ch·ª©a ch·ªØ c√°i'
          },
          icon: 'üë§'
        },
        {
          id: 'phone_number',
          type: 'text',
          label: 'S·ªë ƒëi·ªán tho·∫°i',
          placeholder: '0901234567',
          required: true,
          category: 'basic',
          priority: 'high',
          validation: {
            pattern: '^(0|\\+84)[3-9][0-9]{8}$',
            message: 'S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá'
          },
          icon: 'üì±'
        },
        {
          id: 'email',
          type: 'text',
          label: 'Email',
          placeholder: 'example@email.com',
          required: true,
          category: 'basic',
          priority: 'high',
          validation: {
            pattern: '^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$',
            message: 'Email kh√¥ng h·ª£p l·ªá'
          },
          icon: 'üìß'
        },
        {
          id: 'id_number',
          type: 'text',
          label: 'S·ªë CMND/CCCD',
          placeholder: '123456789012',
          required: true,
          category: 'basic',
          priority: 'high',
          validation: {
            pattern: '^[0-9]{9,12}$',
            message: 'CMND/CCCD ph·∫£i c√≥ 9-12 ch·ªØ s·ªë'
          },
          icon: 'üÜî'
        },
        {
          id: 'date_of_birth',
          type: 'date',
          label: 'Ng√†y sinh',
          required: true,
          category: 'basic',
          priority: 'high',
          validation: {
            min: 18, // Minimum age
            max: 65, // Maximum age
            message: 'Tu·ªïi ph·∫£i t·ª´ 18-65'
          },
          icon: 'üìÖ'
        }
      ]
    },
    {
      id: 'financial',
      name: 'Th√¥ng tin t√†i ch√≠nh',
      description: 'Thu nh·∫≠p v√† t√¨nh h√¨nh t√†i ch√≠nh hi·ªán t·∫°i',
      icon: 'üí∞',
      questions: [
        {
          id: 'monthly_income',
          type: 'select',
          label: 'Thu nh·∫≠p h√†ng th√°ng',
          required: true,
          options: [
            'D∆∞·ªõi 10 tri·ªáu VNƒê',
            '10-20 tri·ªáu VNƒê',
            '20-30 tri·ªáu VNƒê',
            '30-50 tri·ªáu VNƒê',
            '50-100 tri·ªáu VNƒê',
            'Tr√™n 100 tri·ªáu VNƒê'
          ],
          category: 'financial',
          priority: 'high',
          helpText: 'Bao g·ªìm l∆∞∆°ng, kinh doanh v√† c√°c kho·∫£n thu nh·∫≠p kh√°c',
          icon: 'üíµ'
        },
        {
          id: 'income_stability',
          type: 'select',
          label: 'T√≠nh ·ªïn ƒë·ªãnh c·ªßa thu nh·∫≠p',
          required: true,
          options: [
            'R·∫•t ·ªïn ƒë·ªãnh (l∆∞∆°ng c·ªë ƒë·ªãnh)',
            '·ªîn ƒë·ªãnh (c√≥ bi·∫øn ƒë·ªông nh·∫π)',
            'Kh√¥ng ·ªïn ƒë·ªãnh (thu nh·∫≠p theo d·ª± √°n)',
            'M·ªõi b·∫Øt ƒë·∫ßu c√≥ thu nh·∫≠p'
          ],
          category: 'financial',
          priority: 'high',
          icon: 'üìä'
        },
        {
          id: 'monthly_expenses',
          type: 'select',
          label: 'Chi ph√≠ sinh ho·∫°t h√†ng th√°ng',
          required: true,
          options: [
            'D∆∞·ªõi 5 tri·ªáu VNƒê',
            '5-10 tri·ªáu VNƒê',
            '10-20 tri·ªáu VNƒê',
            '20-30 tri·ªáu VNƒê',
            'Tr√™n 30 tri·ªáu VNƒê'
          ],
          category: 'financial',
          priority: 'medium',
          helpText: 'Bao g·ªìm ƒÉn u·ªëng, nh√† ·ªü, di chuy·ªÉn, gi·∫£i tr√≠',
          icon: 'üè†'
        }
      ]
    },
    {
      id: 'employment',
      name: 'Th√¥ng tin ngh·ªÅ nghi·ªáp',
      description: 'T√¨nh tr·∫°ng vi·ªác l√†m v√† n∆°i l√†m vi·ªác',
      icon: 'üíº',
      questions: [
        {
          id: 'employment_type',
          type: 'select',
          label: 'Lo·∫°i h√¨nh vi·ªác l√†m',
          required: true,
          options: [
            'Nh√¢n vi√™n ch√≠nh th·ª©c',
            'Nh√¢n vi√™n h·ª£p ƒë·ªìng',
            'Kinh doanh t·ª± do',
            'Freelancer',
            'Sinh vi√™n c√≥ thu nh·∫≠p',
            'Ngh·ªâ h∆∞u c√≥ l∆∞∆°ng h∆∞u'
          ],
          category: 'employment',
          priority: 'high',
          icon: 'üëî'
        },
        {
          id: 'work_experience',
          type: 'select',
          label: 'Kinh nghi·ªám l√†m vi·ªác',
          required: true,
          options: [
            'D∆∞·ªõi 1 nƒÉm',
            '1-3 nƒÉm',
            '3-5 nƒÉm',
            '5-10 nƒÉm',
            'Tr√™n 10 nƒÉm'
          ],
          category: 'employment',
          priority: 'medium',
          icon: '‚è≥'
        },
        {
          id: 'company_type',
          type: 'select',
          label: 'Lo·∫°i doanh nghi·ªáp',
          required: false,
          options: [
            'C√¥ng ty nh√† n∆∞·ªõc',
            'C√¥ng ty t∆∞ nh√¢n',
            'C√¥ng ty n∆∞·ªõc ngo√†i',
            'Doanh nghi·ªáp t∆∞ nh√¢n',
            'C∆° quan ch√≠nh ph·ªß',
            'T·ªï ch·ª©c phi l·ª£i nhu·∫≠n'
          ],
          category: 'employment',
          priority: 'low',
          dependsOn: 'employment_type',
          showWhen: (value) => ['Nh√¢n vi√™n ch√≠nh th·ª©c', 'Nh√¢n vi√™n h·ª£p ƒë·ªìng'].includes(value),
          icon: 'üè¢'
        }
      ]
    },
    {
      id: 'credit',
      name: 'L·ªãch s·ª≠ t√≠n d·ª•ng',
      description: 'Kinh nghi·ªám s·ª≠ d·ª•ng c√°c s·∫£n ph·∫©m t√≠n d·ª•ng',
      icon: 'üìà',
      questions: [
        {
          id: 'existing_credit_cards',
          type: 'select',
          label: 'S·ªë th·∫ª t√≠n d·ª•ng hi·ªán c√≥',
          required: true,
          options: [
            'Ch∆∞a c√≥ th·∫ª n√†o',
            '1 th·∫ª',
            '2-3 th·∫ª',
            '4-5 th·∫ª',
            'Tr√™n 5 th·∫ª'
          ],
          category: 'credit',
          priority: 'high',
          icon: 'üí≥'
        },
        {
          id: 'payment_history',
          type: 'select',
          label: 'L·ªãch s·ª≠ thanh to√°n',
          required: true,
          options: [
            'Lu√¥n thanh to√°n ƒë√∫ng h·∫°n',
            'Th·ªânh tho·∫£ng tr·ªÖ h·∫°n',
            'Th∆∞·ªùng xuy√™n tr·ªÖ h·∫°n',
            'Ch∆∞a c√≥ l·ªãch s·ª≠ t√≠n d·ª•ng'
          ],
          category: 'credit',
          priority: 'high',
          dependsOn: 'existing_credit_cards',
          showWhen: (value) => value !== 'Ch∆∞a c√≥ th·∫ª n√†o',
          icon: '‚úÖ'
        },
        {
          id: 'current_debt',
          type: 'select',
          label: 'T·ªïng d∆∞ n·ª£ hi·ªán t·∫°i',
          required: false,
          options: [
            'Kh√¥ng c√≥ n·ª£',
            'D∆∞·ªõi 10 tri·ªáu VNƒê',
            '10-50 tri·ªáu VNƒê',
            '50-100 tri·ªáu VNƒê',
            'Tr√™n 100 tri·ªáu VNƒê'
          ],
          category: 'credit',
          priority: 'medium',
          helpText: 'Bao g·ªìm th·∫ª t√≠n d·ª•ng, vay c√° nh√¢n, vay mua nh√†/xe',
          icon: 'üìã'
        }
      ]
    }
  ],
  smartValidation: {
    creditScoreEstimation: true,
    incomeVerification: true,
    riskAssessment: true
  }
};

// Mortgage Loan Questionnaire (Optimized)
const mortgageQuestionnaire: OptimizedQuestionForm = {
  productType: 'mortgage_loan',
  title: 'Vay Mua Nh√†/B·∫•t ƒê·ªông S·∫£n',
  description: 'Th√¥ng tin chi ti·∫øt ƒë·ªÉ ƒë√°nh gi√° kh·∫£ nƒÉng vay v√† ƒë·ªÅ xu·∫•t g√≥i vay t·ªëi ∆∞u',
  estimatedTime: '8-12 ph√∫t',
  categories: [
    {
      id: 'product_specific',
      name: 'Th√¥ng tin b·∫•t ƒë·ªông s·∫£n',
      description: 'Chi ti·∫øt v·ªÅ b·∫•t ƒë·ªông s·∫£n b·∫°n mu·ªën mua',
      icon: 'üè†',
      questions: [
        {
          id: 'property_type',
          type: 'select',
          label: 'Lo·∫°i b·∫•t ƒë·ªông s·∫£n',
          required: true,
          options: [
            'CƒÉn h·ªô chung c∆∞',
            'Nh√† ri√™ng/Nh√† ph·ªë',
            'Bi·ªát th·ª±',
            'ƒê·∫•t n·ªÅn',
            'Shophouse',
            'Nh√† x∆∞·ªüng/Kho'
          ],
          category: 'product_specific',
          priority: 'high',
          icon: 'üèòÔ∏è'
        },
        {
          id: 'property_status',
          type: 'select',
          label: 'T√¨nh tr·∫°ng b·∫•t ƒë·ªông s·∫£n',
          required: true,
          options: [
            'ƒê√£ ho√†n th√†nh',
            'ƒêang x√¢y d·ª±ng',
            'Ch∆∞a kh·ªüi c√¥ng',
            'Nh√† c≈© c·∫ßn s·ª≠a ch·ªØa'
          ],
          category: 'product_specific',
          priority: 'high',
          icon: 'üöß'
        },
        {
          id: 'property_value',
          type: 'select',
          label: 'Gi√° tr·ªã b·∫•t ƒë·ªông s·∫£n',
          required: true,
          options: [
            'D∆∞·ªõi 1 t·ª∑ VNƒê',
            '1-2 t·ª∑ VNƒê',
            '2-3 t·ª∑ VNƒê',
            '3-5 t·ª∑ VNƒê',
            '5-10 t·ª∑ VNƒê',
            'Tr√™n 10 t·ª∑ VNƒê'
          ],
          category: 'product_specific',
          priority: 'high',
          helpText: 'Gi√° tr·ªã theo h·ª£p ƒë·ªìng mua b√°n ho·∫∑c ƒë·ªãnh gi√° th·ªã tr∆∞·ªùng',
          icon: 'üí∞'
        },
        {
          id: 'down_payment_percentage',
          type: 'select',
          label: 'T·ª∑ l·ªá v·ªën t·ª± c√≥',
          required: true,
          options: [
            '15-20%',
            '20-30%',
            '30-40%',
            '40-50%',
            'Tr√™n 50%'
          ],
          category: 'product_specific',
          priority: 'high',
          helpText: 'S·ªë ti·ªÅn b·∫°n c√≥ th·ªÉ tr·∫£ tr∆∞·ªõc so v·ªõi gi√° tr·ªã BƒêS',
          icon: 'üìä'
        },
        {
          id: 'loan_term_preference',
          type: 'select',
          label: 'Th·ªùi h·∫°n vay mong mu·ªën',
          required: true,
          options: [
            '5-10 nƒÉm',
            '10-15 nƒÉm',
            '15-20 nƒÉm',
            '20-25 nƒÉm',
            'T·ªëi ƒëa c√≥ th·ªÉ'
          ],
          category: 'product_specific',
          priority: 'high',
          icon: '‚è∞'
        }
      ]
    },
    {
      id: 'financial',
      name: 'T√¨nh h√¨nh t√†i ch√≠nh',
      description: 'Thu nh·∫≠p, t√†i s·∫£n v√† kh·∫£ nƒÉng t√†i ch√≠nh',
      icon: 'üí∞',
      questions: [
        {
          id: 'primary_income',
          type: 'select',
          label: 'Thu nh·∫≠p ch√≠nh h√†ng th√°ng',
          required: true,
          options: [
            '20-30 tri·ªáu VNƒê',
            '30-50 tri·ªáu VNƒê',
            '50-100 tri·ªáu VNƒê',
            '100-200 tri·ªáu VNƒê',
            'Tr√™n 200 tri·ªáu VNƒê'
          ],
          category: 'financial',
          priority: 'high',
          icon: 'üíµ'
        },
        {
          id: 'income_sources',
          type: 'checkbox',
          label: 'Ngu·ªìn thu nh·∫≠p',
          required: true,
          options: [
            'L∆∞∆°ng ch√≠nh th·ª©c',
            'Kinh doanh',
            'Cho thu√™ b·∫•t ƒë·ªông s·∫£n',
            'ƒê·∫ßu t∆∞ ch·ª©ng kho√°n',
            'Thu nh·∫≠p t·ª´ freelance',
            'Ngu·ªìn kh√°c'
          ],
          category: 'financial',
          priority: 'high',
          helpText: 'Ch·ªçn t·∫•t c·∫£ ngu·ªìn thu nh·∫≠p c·ªßa b·∫°n',
          icon: 'üìà'
        },
        {
          id: 'financial_assets',
          type: 'select',
          label: 'T√†i s·∫£n t√†i ch√≠nh hi·ªán c√≥',
          required: false,
          options: [
            'D∆∞·ªõi 100 tri·ªáu VNƒê',
            '100-500 tri·ªáu VNƒê',
            '500 tri·ªáu - 1 t·ª∑ VNƒê',
            '1-2 t·ª∑ VNƒê',
            'Tr√™n 2 t·ª∑ VNƒê'
          ],
          category: 'financial',
          priority: 'medium',
          helpText: 'Ti·ªÅn g·ª≠i, ch·ª©ng kho√°n, b·∫£o hi·ªÉm c√≥ gi√° tr·ªã ho√†n l·∫°i',
          icon: 'üè¶'
        },
        {
          id: 'existing_properties',
          type: 'select',
          label: 'B·∫•t ƒë·ªông s·∫£n hi·ªán c√≥',
          required: false,
          options: [
            'Ch∆∞a c√≥',
            '1 b·∫•t ƒë·ªông s·∫£n',
            '2-3 b·∫•t ƒë·ªông s·∫£n',
            'Tr√™n 3 b·∫•t ƒë·ªông s·∫£n'
          ],
          category: 'financial',
          priority: 'medium',
          icon: 'üè°'
        }
      ]
    },
    {
      id: 'employment',
      name: 'Th√¥ng tin ngh·ªÅ nghi·ªáp',
      description: 'T√¨nh tr·∫°ng c√¥ng vi·ªác v√† thu nh·∫≠p',
      icon: 'üíº',
      questions: [
        {
          id: 'employment_status',
          type: 'select',
          label: 'T√¨nh tr·∫°ng vi·ªác l√†m',
          required: true,
          options: [
            'Nh√¢n vi√™n ch√≠nh th·ª©c',
            'Ch·ªß doanh nghi·ªáp',
            'Gi√°m ƒë·ªëc/Qu·∫£n l√Ω c·∫•p cao',
            'Freelancer/T·ª± do',
            'Ngh·ªâ h∆∞u c√≥ thu nh·∫≠p'
          ],
          category: 'employment',
          priority: 'high',
          icon: 'üëî'
        },
        {
          id: 'job_stability',
          type: 'select',
          label: 'Th·ªùi gian ·ªïn ƒë·ªãnh c√¥ng vi·ªác hi·ªán t·∫°i',
          required: true,
          options: [
            'D∆∞·ªõi 1 nƒÉm',
            '1-2 nƒÉm',
            '2-5 nƒÉm',
            '5-10 nƒÉm',
            'Tr√™n 10 nƒÉm'
          ],
          category: 'employment',
          priority: 'high',
          icon: '‚è≥'
        },
        {
          id: 'industry_type',
          type: 'select',
          label: 'Lƒ©nh v·ª±c c√¥ng vi·ªác',
          required: false,
          options: [
            'Ng√¢n h√†ng/T√†i ch√≠nh',
            'C√¥ng ngh·ªá th√¥ng tin',
            'Y t·∫ø',
            'Gi√°o d·ª•c',
            'B·∫•t ƒë·ªông s·∫£n',
            'S·∫£n xu·∫•t',
            'D·ªãch v·ª•',
            'Kh√°c'
          ],
          category: 'employment',
          priority: 'low',
          icon: 'üè≠'
        }
      ]
    },
    {
      id: 'credit',
      name: 'L·ªãch s·ª≠ t√≠n d·ª•ng',
      description: 'Kinh nghi·ªám vay v·ªën v√† t√≠n d·ª•ng',
      icon: 'üìà',
      questions: [
        {
          id: 'mortgage_experience',
          type: 'select',
          label: 'Kinh nghi·ªám vay mua nh√†',
          required: true,
          options: [
            'L·∫ßn ƒë·∫ßu vay mua nh√†',
            'ƒê√£ t·ª´ng vay mua nh√†',
            'Hi·ªán c√≥ kho·∫£n vay nh√†',
            'ƒê√£ tr·∫£ h·∫øt n·ª£ nh√†'
          ],
          category: 'credit',
          priority: 'high',
          icon: 'üè†'
        },
        {
          id: 'current_debts',
          type: 'select',
          label: 'T·ªïng n·ª£ hi·ªán t·∫°i',
          required: true,
          options: [
            'Kh√¥ng c√≥ n·ª£',
            'D∆∞·ªõi 100 tri·ªáu VNƒê',
            '100-500 tri·ªáu VNƒê',
            '500 tri·ªáu - 1 t·ª∑ VNƒê',
            'Tr√™n 1 t·ª∑ VNƒê'
          ],
          category: 'credit',
          priority: 'high',
          helpText: 'Bao g·ªìm th·∫ª t√≠n d·ª•ng, vay c√° nh√¢n, vay xe, vay nh√† kh√°c',
          icon: 'üìã'
        },
        {
          id: 'credit_score_self_assessment',
          type: 'select',
          label: 'T·ª± ƒë√°nh gi√° m·ª©c ƒë·ªô t√≠n d·ª•ng',
          required: false,
          options: [
            'R·∫•t t·ªët - kh√¥ng n·ª£ x·∫•u',
            'T·ªët - tr·∫£ n·ª£ ƒë√∫ng h·∫°n',
            'Trung b√¨nh - c√≥ tr·ªÖ h·∫°n nh·∫π',
            'C·∫ßn c·∫£i thi·ªán',
            'Kh√¥ng r√µ'
          ],
          category: 'credit',
          priority: 'medium',
          icon: '‚≠ê'
        }
      ]
    }
  ],
  smartValidation: {
    creditScoreEstimation: true,
    incomeVerification: true,
    riskAssessment: true
  }
};

// Car Loan Questionnaire (New)
const carLoanQuestionnaire: OptimizedQuestionForm = {
  productType: 'car_loan',
  title: 'Vay Mua Xe',
  description: 'Th√¥ng tin ƒë·ªÉ t√¨m g√≥i vay xe ph√π h·ª£p v·ªõi nhu c·∫ßu c·ªßa b·∫°n',
  estimatedTime: '4-6 ph√∫t',
  categories: [
    {
      id: 'product_specific',
      name: 'Th√¥ng tin xe mu·ªën mua',
      description: 'Chi ti·∫øt v·ªÅ chi·∫øc xe b·∫°n quan t√¢m',
      icon: 'üöó',
      questions: [
        {
          id: 'car_type',
          type: 'select',
          label: 'Lo·∫°i xe',
          required: true,
          options: [
            'Xe du l·ªãch (sedan)',
            'Xe SUV/CUV',
            'Xe pickup/b√°n t·∫£i',
            'Xe hatchback',
            'Xe th·ªÉ thao',
            'Xe ƒëi·ªán'
          ],
          category: 'product_specific',
          priority: 'high',
          icon: 'üöô'
        },
        {
          id: 'car_condition',
          type: 'select',
          label: 'T√¨nh tr·∫°ng xe',
          required: true,
          options: [
            'Xe m·ªõi 100%',
            'Xe ƒë√£ qua s·ª≠ d·ª•ng (d∆∞·ªõi 5 nƒÉm)',
            'Xe ƒë√£ qua s·ª≠ d·ª•ng (5-10 nƒÉm)',
            'Xe c≈© (tr√™n 10 nƒÉm)'
          ],
          category: 'product_specific',
          priority: 'high',
          icon: 'üîß'
        },
        {
          id: 'car_value',
          type: 'select',
          label: 'Gi√° tr·ªã xe',
          required: true,
          options: [
            'D∆∞·ªõi 500 tri·ªáu VNƒê',
            '500 tri·ªáu - 1 t·ª∑ VNƒê',
            '1-1.5 t·ª∑ VNƒê',
            '1.5-2 t·ª∑ VNƒê',
            'Tr√™n 2 t·ª∑ VNƒê'
          ],
          category: 'product_specific',
          priority: 'high',
          icon: 'üí∞'
        }
      ]
    }
  ],
  smartValidation: {
    creditScoreEstimation: true,
    incomeVerification: false,
    riskAssessment: true
  }
};

// Business Loan Questionnaire (New)
const businessLoanQuestionnaire: OptimizedQuestionForm = {
  productType: 'business_loan',
  title: 'Vay Kinh Doanh',
  description: 'Th√¥ng tin ƒë·ªÉ ƒë√°nh gi√° v√† ƒë·ªÅ xu·∫•t g√≥i vay kinh doanh ph√π h·ª£p',
  estimatedTime: '6-8 ph√∫t',
  categories: [
    {
      id: 'product_specific',
      name: 'Th√¥ng tin kinh doanh',
      description: 'Chi ti·∫øt v·ªÅ doanh nghi·ªáp v√† nhu c·∫ßu vay',
      icon: 'üè¢',
      questions: [
        {
          id: 'business_type',
          type: 'select',
          label: 'Lo·∫°i h√¨nh doanh nghi·ªáp',
          required: true,
          options: [
            'Doanh nghi·ªáp t∆∞ nh√¢n',
            'C√¥ng ty TNHH',
            'C√¥ng ty c·ªï ph·∫ßn',
            'H·ªô kinh doanh c√° th·ªÉ'
          ],
          category: 'product_specific',
          priority: 'high',
          icon: 'üè≠'
        }
      ]
    }
  ],
  smartValidation: {
    creditScoreEstimation: true,
    incomeVerification: true,
    riskAssessment: true
  }
};

// Education Loan Questionnaire (New)
const educationLoanQuestionnaire: OptimizedQuestionForm = {
  productType: 'education_loan',
  title: 'Vay H·ªçc T·∫≠p',
  description: 'Th√¥ng tin ƒë·ªÉ ƒë√°nh gi√° nhu c·∫ßu vay h·ªçc ph√≠ v√† chi ph√≠ h·ªçc t·∫≠p',
  estimatedTime: '4-6 ph√∫t',
  categories: [
    {
      id: 'product_specific',
      name: 'Th√¥ng tin h·ªçc t·∫≠p',
      description: 'Chi ti·∫øt v·ªÅ kh√≥a h·ªçc v√† nhu c·∫ßu t√†i ch√≠nh',
      icon: 'üéì',
      questions: [
        {
          id: 'education_level',
          type: 'select',
          label: 'B·∫≠c h·ªçc',
          required: true,
          options: [
            'ƒê·∫°i h·ªçc',
            'Th·∫°c sƒ©',
            'Ti·∫øn sƒ©',
            'Kh√≥a h·ªçc ngh·ªÅ nghi·ªáp'
          ],
          category: 'product_specific',
          priority: 'high',
          icon: 'üìö'
        }
      ]
    }
  ],
  smartValidation: {
    creditScoreEstimation: false,
    incomeVerification: false,
    riskAssessment: true
  }
};

export const optimizedQuestionnaires: Record<LoanProductType, OptimizedQuestionForm> = {
  credit_loan: creditCardQuestionnaire,
  mortgage_loan: mortgageQuestionnaire,
  car_loan: carLoanQuestionnaire,
  business_loan: businessLoanQuestionnaire,
  education_loan: educationLoanQuestionnaire
};

// Utility functions for smart questionnaire handling
export const getQuestionnaireForProduct = (productType: LoanProductType): OptimizedQuestionForm => {
  return optimizedQuestionnaires[productType];
};

export const getHighPriorityQuestions = (questionnaire: OptimizedQuestionForm): OptimizedQuestion[] => {
  return questionnaire.categories
    .flatMap(category => category.questions)
    .filter(question => question.priority === 'high');
};

export const getConditionalQuestions = (
  questionnaire: OptimizedQuestionForm,
  formData: Record<string, any>
): OptimizedQuestion[] => {
  return questionnaire.categories
    .flatMap(category => category.questions)
    .filter(question => {
      if (!question.dependsOn || !question.showWhen) return true;
      const dependentValue = formData[question.dependsOn];
      return question.showWhen(dependentValue);
    });
};

export const validateQuestionResponse = (
  question: OptimizedQuestion,
  value: any
): { isValid: boolean; message?: string } => {
  if (question.required && (!value || value === '')) {
    return { isValid: false, message: `${question.label} l√† b·∫Øt bu·ªôc` };
  }

  if (question.validation && value) {
    const { min, max, pattern, message } = question.validation;
    
    if (question.type === 'number') {
      const numValue = Number(value);
      if (min && numValue < min) {
        return { isValid: false, message: message || `Gi√° tr·ªã t·ªëi thi·ªÉu l√† ${min}` };
      }
      if (max && numValue > max) {
        return { isValid: false, message: message || `Gi√° tr·ªã t·ªëi ƒëa l√† ${max}` };
      }
    }

    if (pattern && typeof value === 'string') {
      const regex = new RegExp(pattern);
      if (!regex.test(value)) {
        return { isValid: false, message: message || 'ƒê·ªãnh d·∫°ng kh√¥ng h·ª£p l·ªá' };
      }
    }
  }

  return { isValid: true };
};